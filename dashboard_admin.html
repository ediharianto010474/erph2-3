<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Admin</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        h1 {
            text-align: center;
            color: #66ccff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            font-size: 3rem;
            margin-bottom: 10px;
            width: 100%;
        }

.header-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    max-width: 1400px;
    margin: 0 auto 20px;
    padding: 0 20px;
}

.header-logo {
    height: 100px; /* Sesuaikan saiz mengikut keperluan */
    width: auto;
    object-fit: contain;
}

.left-logo {
    margin-right: 20px;
}

.right-logo {
    margin-left: 20px;
}

/* Pastikan tajuk berada di tengah */
.header-container h1 {
    margin: 0;
    flex: 1;
    text-align: center;
}


        .welcome {
            text-align: center;
            font-size: 1.2rem;
            margin-bottom: 20px;
            font-weight: bold;
            width: 100%;
        }

        .action-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 20px 0;
        }

        .btn-daftar {
            background-color: #ff6b00;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        .btn-daftar:hover {
            background-color: #e65c00;
        }

        .main-layout {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .left-col, {
            flex: 1;
            box-sizing: border-box;
        }

        .right-col {
            flex" 2;
            box-sizing: border-box;
         }

        .table-container {
            width: 100%;
            margin-bottom: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            overflow: hidden;
            font-size: 0.7rem;
        }

        .table-container table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 0;
        }

        .table-container th,
        .table-container td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: left;
        }

        .table-container th {
            background-color: #005588;
            color: white;
            font-weight: bold;
        }

        .table-container tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        .table-container tr:hover {
            background-color: #e0e0e0;
        }

        .logout-link {
            color: red;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: bold;
            padding: 8px 16px;
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        .logout-link:hover {
            background-color: #ffe6e6;
            text-decoration: underline;
        }

        .action-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            margin: 0 5px;
            transition: background-color 0.3s;
        }

        .reset-btn {
            background-color: #d35400;
            color: white;
        }

        .reset-btn:hover {
            background-color: #c04600;
        }

        .delete-btn {
            background-color: #27ae60;
            color: white;
        }

        .delete-btn:hover {
            background-color: #219653;
        }

        .note {
            font-size: 0.8rem;
            color: #555;
            margin: 10px 0;
            line-height: 1.5;
        }

        #loading {
            text-align: center;
            color: #005588;
            font-weight: bold;
            padding: 20px;
        }

        .footer {
            position: fixed;
            bottom: 10px;
            right: 20px;
            font-size: 0.9rem;
            color: #555;
            font-style: italic;
        }

        /* Modal Daftar User */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 400px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: black;
        }

        .register-form input {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }

        .register-btn {
            width: 100%;
            padding: 10px;
            background-color: #0099cc;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }

        .message {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            display: none;
        }

        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* Week Section */
        .week-section {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 30px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        .week-title {
            font-size: 1.3rem;
            color: #005588;
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header-container">
    <img src="logo.png" alt="Logo Sekolah" class="header-logo left-logo">
    <h1>Dashboard Admin</h1>
    <img src="erph.png" alt="Logo eRPH" class="header-logo right-logo">
</div>
    <p class="welcome">Selamat Datang : <strong>ADMIN</strong></p>

    <div class="action-bar">
        <button class="btn-daftar">DAFTAR USER</button>
        <a href="login.html" class="logout-link" onclick="localStorage.removeItem('loggedInUser'); alert('Anda telah logout.');">Logout</a>
    </div>
</div>

<div class="main-layout">
    <!-- Kolom Kiri: Senarai Guru -->
    <div class="left-col">
        <div class="table-container">
            <h3 style="text-align: center; margin: 0; padding: 10px 0; background-color: #005588; color: white;">SENARAI NAMA GURU</h3>
            <table id="guruTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>NAMA GURU</th>
                        <th>RESET PASSWORD</th>
                        <th>ACTION</th>
                    </tr>
                </thead>
                <tbody id="guruTableBody">
                    <tr><td colspan="4" id="loading">Memuatkan data guru...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Kolom Kanan: RPH Mingguan -->
    <div class="right-col">
        <div class="table-container">
            <h3 style="text-align: center; margin: 0; padding: 10px 0; background-color: #005588; color: white;">RPH UNTUK SEMAKAN</h3>
            <div id="rphWeeksContainer" style="padding: 15px;">
                <p style="text-align: center; color: #888;">Memuatkan data RPH...</p>
            </div>
        </div>
    </div>
</div>

<!-- MODAL DAFTAR USER -->
<div id="registerModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h3>Daftar User Baru</h3>
        <form id="registerForm" class="register-form">
            <input type="text" id="regName" placeholder="Nama Guru" required>
            <input type="text" id="regUsername" placeholder="Username" required>
            <input type="password" id="regPassword" placeholder="Password" required>
            <button type="submit" class="register-btn">DAFTAR</button>
        </form>
        <div id="registerMessage" class="message"></div>
    </div>
</div>

<footer class="footer">
    Hak Cipta Terpelihara : Bayu Utara 2025
</footer>

<script>
    // ========================
    // UTILITIES
    // ========================
    function parseDate(dateStr) {
        const [y, m, d] = dateStr.split('-').map(Number);
        return new Date(y, m - 1, d);
    }

    function getDayIndex(date) {
        const day = date.getDay(); // 0=Ahad, 1=Isnin, ..., 5=Jumaat
        return day === 0 ? 7 : day;
    }

    function getWeekNumber(date) {
        const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
        const dayNum = d.getUTCDay() || 7;
        d.setUTCDate(d.getUTCDate() + 4 - dayNum);
        const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
        return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
    }

// 🔴 INI WAJIB ADA — JANGAN HILANGKAN!
function getWeekRange(date) {
    const day = date.getDay();
    const diffToMonday = day === 0 ? -6 : 1 - day;
    const diffToFriday = day === 0 ? -2 : 5 - day;

    const monday = new Date(date);
    monday.setDate(date.getDate() + diffToMonday);

    const friday = new Date(date);
    friday.setDate(date.getDate() + diffToFriday);

    const format = d => {
        const dd = d.getDate();
        const mm = d.getMonth() + 1;
        const yyyy = d.getFullYear();
        return `${dd}/${mm}/${yyyy}`;
    };

    return `${format(monday)} - ${format(friday)}`;
}

// ========================
// MUAT DATA & PAPARKAN SEMUA RPH LENGKAP
// ========================
async function loadRphAndGuruForFilter() {
    try {
        const rphRes = await fetch('/public/rph_admin.json');
        allRphData = rphRes.ok ? await rphRes.json() : [];
        if (!Array.isArray(allRphData)) allRphData = [];

        const guruRes = await fetch('/public/users.json');
        const guruData = guruRes.ok ? await guruRes.json() : [];
        if (!Array.isArray(guruData)) guruData = [];

        // 🔹 Dapatkan senarai nama unik dan susun mengikut abjad
        allGuruList = [...new Set(guruData.map(u => u.name))].sort((a, b) =>
            a.localeCompare(b, 'ms', { sensitivity: 'base' })
        );

        renderGuruDropdownAndTable();
    } catch (error) {
        console.error('Gagal muat data untuk filter:', error);
        document.getElementById('rphWeeksContainer').innerHTML = 
            `<p style="text-align:center; color:red;">Gagal muat data: ${error.message}</p>`;
    }
}

// ========================
// RENDER DROPDOWN + JADUAL SEMUA RPH
// ========================
function renderGuruDropdownAndTable() {
    const container = document.getElementById('rphWeeksContainer');
    let options = '<option value="">-- Paparkan Semua Guru --</option>';
    allGuruList.forEach(name => {
        options += `<option value="${name}">${name}</option>`;
    });

    container.innerHTML = `
        <div style="margin-bottom:15px; text-align:center;">
            <label><strong>Buat Pilihan Guru</strong></label><br>
            <select id="guruFilter" style="padding:8px; font-size:0.7rem; margin-top:8px; min-width:250px;">
                ${options}
            </select>
        </div>
        <div id="filteredRphTable">
            <p style="text-align:center; color:#888;">Memuatkan RPH mingguan lengkap...</p>
        </div>
    `;

    document.getElementById('guruFilter').addEventListener('change', (e) => {
        displayAllCompleteRph(e.target.value || null);
    });

    // Paparkan SEMUA secara default
    displayAllCompleteRph(null);
}

// ========================
// PAPARKAN SEMUA MINGGU LENGKAP (DENGAN "DISEMAK OLEH")
// ========================
async function displayAllCompleteRph(filterGuru = null) {
    const tableContainer = document.getElementById('filteredRphTable');
    tableContainer.innerHTML = '<p style="text-align:center;">Memproses data RPH mingguan lengkap...</p>';

    try {
        let rphList = filterGuru 
            ? allRphData.filter(r => r.guru === filterGuru)
            : allRphData;

        if (rphList.length === 0) {
            tableContainer.innerHTML = `<p style="text-align:center; color:#888;">Tiada data RPH${filterGuru ? ` untuk ${filterGuru}` : ''}.</p>`;
            return;
        }

        const weeksMap = {};

        rphList.forEach(rph => {
            if (!rph.guru || !rph.tarikh) return;
            const date = parseDate(rph.tarikh);
            const dayIndex = getDayIndex(date);
            if (dayIndex < 1 || dayIndex > 5) return;

            const weekNum = getWeekNumber(date);
            const year = date.getFullYear();
            const key = `${rph.guru}|${year}-W${weekNum}`;

            if (!weeksMap[key]) {
                weeksMap[key] = {
                    guru: rph.guru,
                    year,
                    weekNum,
                    dates: [],
                    refleksiList: [],
                    tarikhRange: getWeekRange(date)
                };
            }
            weeksMap[key].dates.push(rph.tarikh);
            if (rph.refleksi) weeksMap[key].refleksiList.push(rph.refleksi);
        });

        const completeWeeks = Object.values(weeksMap)
            .filter(w => w.dates.length >= 5)
            .sort((a, b) => {
                if (a.year !== b.year) return a.year - b.year;
                if (a.weekNum !== b.weekNum) return a.weekNum - b.weekNum;
                return a.guru.localeCompare(b.guru);
            });

        if (completeWeeks.length === 0) {
            tableContainer.innerHTML = `<p style="text-align:center; color:#888;">Tiada minggu lengkap${filterGuru ? ` untuk ${filterGuru}` : ''}.</p>`;
            return;
        }

        let html = `
            <table class="table-container" style="width:100%; border-collapse:collapse; margin-top:15px;">
                <thead>
                    <tr style="background:#005588; color:white;">
                        <th>Tarikh (Isnin–Jumaat)</th>
                        <th>Guru</th>
                        <th>Minggu</th>
                        <th>Refleksi Ringkas</th>
                        <th>Disemak Oleh</th> <!-- TAJUK DIUBAH -->
                        <th>Komen Mingguan</th>
                        <th>Tindakan</th>
                    </tr>
                </thead>
                <tbody>`;

        for (const week of completeWeeks) {
            let feedback = { comment: '', reviewedBy: '' };
            try {
                const fbRes = await fetch(`/weekly-feedback?year=${week.year}&week=${week.weekNum}&guru=${encodeURIComponent(week.guru)}`);
                if (fbRes.ok) feedback = await fbRes.json();
            } catch (err) {
                console.warn('Gagal muat komen untuk', week.guru, week.weekNum);
            }

            const refleksiRingkas = week.refleksiList.length > 0 
                ? week.refleksiList[0].substring(0, 50) + (week.refleksiList[0].length > 50 ? '...' : '')
                : 'Tiada refleksi';

            // Paparkan "Disemak Oleh" atau "Menunggu Semakan"
            const reviewedByText = feedback.reviewedBy 
                ? `Disemak Oleh: ${feedback.reviewedBy}`
                : 'Menunggu Semakan';

            html += `
                <tr>
                    <td>${week.tarikhRange}</td>
                    <td>${week.guru}</td>
                    <td>${week.weekNum}</td>
                    <td title="${week.refleksiList.join('\n\n')}">${refleksiRingkas}</td>
                    <td><span class="reviewed-by">${reviewedByText}</span></td> <!-- GANTI DENGAN SPAN -->
                    <td>
                        <textarea class="week-comment" 
                                  data-year="${week.year}" 
                                  data-week="${week.weekNum}" 
                                  data-guru="${week.guru}" 
                                  rows="2" 
                                  style="width:100%; font-size:0.85rem;">${feedback.comment || ''}</textarea>
                    </td>
                    <td>
                        <button class="save-week-btn" 
                                data-year="${week.year}" 
                                data-week="${week.weekNum}" 
                                data-guru="${week.guru}" 
                                style="padding:6px 10px; background:#0099cc; color:white; border:none; border-radius:4px; cursor:pointer;">
                            Simpan
                        </button>
                    </td>
                </tr>`;
        }

        html += `</tbody></table>`;
        tableContainer.innerHTML = html;

        // Pasang event listener untuk butang simpan
        document.querySelectorAll('.save-week-btn').forEach(btn => {
            btn.addEventListener('click', async () => {
                const year = btn.dataset.year;
                const week = btn.dataset.week;
                const guru = btn.dataset.guru;
                const commentEl = document.querySelector(`.week-comment[data-year="${year}"][data-week="${week}"][data-guru="${guru}"]`);
                if (!commentEl) return;

                const comment = commentEl.value.trim();
                const loggedInUser = JSON.parse(localStorage.getItem('loggedInUser'));
                const reviewerName = loggedInUser ? loggedInUser.name : 'Admin';

                const success = await saveWeeklyFeedback(year, week, guru, comment, reviewerName);
                if (success) {
                    // Kemas kini UI: tukar kepada "Disemak Oleh: ..."
                    const reviewedByEl = btn.closest('tr').querySelector('.reviewed-by');
                    if (reviewedByEl) {
                        reviewedByEl.textContent = `Disemak Oleh: ${reviewerName}`;
                    }
                    btn.textContent = '✓';
                    setTimeout(() => btn.textContent = 'Simpan', 1000);
                }
            });
        });

    } catch (error) {
        console.error('Ralat memaparkan RPH:', error);
        tableContainer.innerHTML = `<p style="text-align:center; color:red;">Ralat: ${error.message}</p>`;
    }
}

// ========================
// SIMPAN KOMEN MINGGUAN BERSAMA NAMA PENGULAS
// ========================
async function saveWeeklyFeedback(year, weekNumber, guru, comment, reviewedBy) {
    try {
        const response = await fetch('/save-weekly-feedback', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ year, weekNumber, guru, comment, reviewedBy })
        });
        if (response.ok) {
            return true;
        } else {
            const err = await response.json();
            alert('❌ Gagal simpan: ' + (err.error || 'Ralat tidak diketahui.'));
            return false;
        }
    } catch (error) {
        console.error('Error simpan komen mingguan:', error);
        alert('❌ Ralat rangkaian.');
        return false;
    }
}

    // ========================
    // PENGURUSAN GURU
    // ========================
async function loadGuruData() {
    const tableBody = document.getElementById('guruTableBody');
    tableBody.innerHTML = '<tr><td colspan="4" id="loading">Memuatkan data guru...</td></tr>';

    try {
        const response = await fetch('/public/users.json');
        const users = await response.json();

        // 🔹 SUSUN MENGIKUT ABJAD (A–Z) BERDASARKAN NAMA
        users.sort((a, b) => a.name.localeCompare(b.name, 'ms', { sensitivity: 'base' }));

        tableBody.innerHTML = '';

        if (!Array.isArray(users) || users.length === 0) {
            tableBody.innerHTML = '<tr><td colspan="4" style="text-align:center; color:#888;">Tiada data guru.</td></tr>';
            return;
        }

        users.forEach(user => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${user.id}</td>
                <td>${user.name}</td>
                <td><button class="action-btn reset-btn" data-id="${user.id}">RESET</button></td>
                <td><button class="action-btn delete-btn" data-id="${user.id}">PADAM</button></td>
            `;
            tableBody.appendChild(row);
        });

            document.querySelectorAll('.reset-btn').forEach(btn => {
    btn.addEventListener('click', async () => {
        const id = btn.getAttribute('data-id');
        if (!confirm(`Tetapkan semula kata laluan untuk ID: ${id}?`)) return;

        try {
            const response = await fetch('/reset-password', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ id })
            });

            const result = await response.json();
            if (response.ok) {
                alert('✅ ' + result.message);
                // Pilihan: Anda boleh muat semula senarai guru di sini jika perlu
                // loadGuruData();
            } else {
                alert('❌ Gagal: ' + (result.error || 'Ralat tidak diketahui.'));
            }
        } catch (error) {
            console.error('Ralat menetapkan semula kata laluan:', error);
            alert('❌ Ralat rangkaian. Sila cuba lagi.');
        }
    });
});

            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', async () => {
                    const id = btn.getAttribute('data-id');
                    if (confirm(`Padam guru ID: ${id}?`)) {
                        await deleteGuru(id);
                        loadGuruData();
                    }
                });
            });

        } catch (error) {
            console.error('Error muat guru:', error);
            tableBody.innerHTML = `<tr><td colspan="4" style="text-align:center; color:red;">Ralat: ${error.message}</td></tr>`;
        }
    }

// Gantikan fungsi deleteGuru() yang sedia ada dengan ini:
async function deleteGuru(id) {
    try {
        // 1. Muat data sedia ada
        const res = await fetch('/public/users.json');
        if (!res.ok) throw new Error('Gagal muat senarai guru');
        const users = await res.json();
        
        // 2. Tapis keluar pengguna yang dipadam
        const updated = users.filter(u => u.id !== id);
        if (updated.length === users.length) {
            alert('❌ ID guru tidak dijumpai.');
            return;
        }

        // 3. Hantar ke backend untuk disimpan
        const saveRes = await fetch('/save-users', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(updated)
        });

        // 🔴 INI YANG PENTING: SEMAK SAMADA BERJAYA (HTTP 200)
        if (saveRes.ok) {
            alert('✅ Guru berjaya dipadam.');
        } else {
            const err = await saveRes.json().catch(() => ({}));
            throw new Error(err.message || 'Gagal menyimpan perubahan di pelayan');
        }
    } catch (err) {
        console.error('Ralat memadam guru:', err);
        alert('❌ Gagal memadam guru: ' + err.message);
    }
}

    // ========================
    // MODAL & DAFTAR USER
    // ========================
    document.querySelector('.btn-daftar').addEventListener('click', () => {
        document.getElementById('registerModal').style.display = 'block';
    });

    document.querySelector('.close').addEventListener('click', () => {
        document.getElementById('registerModal').style.display = 'none';
    });

    window.addEventListener('click', (e) => {
        if (e.target === document.getElementById('registerModal')) {
            document.getElementById('registerModal').style.display = 'none';
        }
    });

document.getElementById('registerForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const name = document.getElementById('regName').value.trim();
    const username = document.getElementById('regUsername').value.trim();
    const password = document.getElementById('regPassword').value.trim();

    const msg = document.getElementById('registerMessage');
    msg.style.display = 'block';

    try {
        // Hantar data ke server
        const newUser = { id: Date.now().toString(), name, username, password };
        const res = await fetch('/save-user', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(newUser)
        });

        // Periksa jika respons adalah JSON sebelum menghuraikannya
        const contentType = res.headers.get('content-type');
        if (contentType && contentType.includes('application/json')) {
            const result = await res.json();
            if (res.ok) {
                // Berjaya
                msg.className = 'message success';
                msg.textContent = '✅ Pendaftaran berjaya!';
                document.getElementById('registerForm').reset();
                setTimeout(() => {
                    document.getElementById('registerModal').style.display = 'none';
                    loadGuruData(); // Muat semula senarai guru
                }, 1500);
            } else {
                // Gagal (tetapi server menghantar JSON)
                msg.className = 'message error';
                msg.textContent = '❌ Gagal: ' + (result.message || 'Pendaftaran tidak berjaya.');
            }
        } else {
            // Respons bukan JSON (kemungkinan besar ralat 404/500 HTML)
            msg.className = 'message error';
            msg.innerHTML = '❌ Gagal daftar: Endpoint <code>/save-user</code> tidak wujud di pelayan.<br>Sila hubungi pembangun sistem.';
            console.error('Server returned non-JSON response for /save-user:', await res.text());
        }

    } catch (error) {
        // Tangkap ralat rangkaian atau ralat lain
        console.error('Ralat semasa mendaftar pengguna:', error);
        msg.className = 'message error';
        msg.textContent = '❌ Ralat: ' + (error.message || 'Gagal menyambung ke pelayan.');
    }
});

// ========================
// INISIALISASI
// ========================
document.addEventListener('DOMContentLoaded', () => {
    const user = JSON.parse(localStorage.getItem('loggedInUser'));
    if (!user || user.role !== 'admin') {
        alert('Akses ditolak. Anda bukan admin.');
        window.location.href = 'login.html';
    } else {
        document.querySelector('.welcome').innerHTML = `Selamat Datang : <strong>${user.name}</strong>`;
        loadGuruData();
        loadRphAndGuruForFilter(); // ← guna fungsi baharu
    }
});
</script>

</body>
</html>